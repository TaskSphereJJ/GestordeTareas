@model GestordeTaras.EN.Usuario

<h1>Mi Perfil</h1>

@await Html.PartialAsync("_AlertMessages")

<!-- Botón para activar el modo de edición -->
<button id="editProfileBtn" class="btn btn-outline-primary" onclick="toggleEditMode()">Editar Perfil</button>

<form id="profileForm" class="table" method="post" asp-action="EditOwn" style="display: none;">
    <input type="hidden" asp-for="Id" />
    <table class="table">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Correo electrónico</th>
                <th>Contraseña</th>
                <th>Teléfono</th>
                <th>Cargo</th> <!-- Campo visible pero no editable -->
                <th>Fecha de Nacimiento</th> 
                <th>Status</th>
                <th>Fecha de Registro</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <input type="text" asp-for="Nombre" class="form-control" />
                    <span asp-validation-for="Nombre" class="text-danger"></span>
                </td>
                <td>
                    <input type="text" asp-for="Apellido" class="form-control" />
                    <span asp-validation-for="Apellido" class="text-danger"></span>
                </td>
                <td>
                    <input type="text" asp-for="NombreUsuario" class="form-control" />
                    <span asp-validation-for="NombreUsuario" class="text-danger"></span>
                </td>
                <td>
                    <input type="password" asp-for="Pass" class="form-control" />
                    <span asp-validation-for="Pass" class="text-danger"></span>
                </td>
                <td>
                    <input type="text" asp-for="Telefono" class="form-control" />
                    <span asp-validation-for="Telefono" class="text-danger"></span>
                </td>
                @if (User.IsInRole("Administrador"))
                {
                    <td>
                        <input type="text" asp-for="Cargo.Nombre" class="form-control" /> <!-- Editable para Administradores -->
                    </td>
                }
                else
                {
                    <td>
                        @Html.DisplayFor(model => model.Cargo.Nombre) <!-- Solo lectura para Colaboradores -->
                    </td>
                }                
                <td>
                    <input type="date" asp-for="FechaNacimiento" class="form-control"
                           value="@Model.FechaNacimiento.ToString("yyyy-MM-dd")" />
                    <span asp-validation-for="FechaNacimiento" class="text-danger"></span>
                </td>
                @if (User.IsInRole("Administrador"))
                {
                    <td>
                        <select asp-for="Status">
                            <option value="1">ACTIVO</option>
                            <option value="2">INACTIVO</option>
                        </select>
                        <span asp-validation-for="Status"></span>
                    </td>
                }

                <td>@Html.DisplayFor(model => model.FechaRegistro)</td>
                <td>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    <button type="button" class="btn btn-danger" onclick="toggleEditMode()">Cancelar</button>
                </td>
            </tr>
        </tbody>
    </table>
</form>

<div id="profileDisplay">
    <table class="table">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Correo electrónico</th>
                <th>Teléfono</th>
                <th>Cargo</th>
                <th>Fecha de Nacimiento</th>              
                <th>Fecha de Registro</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>@Html.DisplayFor(model => model.Nombre)</td>
                <td>@Html.DisplayFor(model => model.Apellido)</td>
                <td>@Html.DisplayFor(model => model.NombreUsuario)</td>
                <td>@Html.DisplayFor(model => model.Telefono)</td>
                <td>@Html.DisplayFor(model => model.Cargo.Nombre)</td>
                <td>@Html.DisplayFor(model => model.FechaNacimiento)</td> 
                <td>@Html.DisplayFor(model => model.FechaRegistro)</td>
                <td>
                    <form method="post" asp-action="DeleteOwn" style="display:inline;">
                        <button type="submit" class="btn btn-outline-danger" onclick="return confirm('¿Estás seguro de que deseas eliminar tu cuenta? Esta acción no se puede deshacer.');">Eliminar Cuenta</button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<script>
    function toggleEditMode() {
        const profileForm = document.getElementById('profileForm');
        const profileDisplay = document.getElementById('profileDisplay');
        const editButton = document.getElementById('editProfileBtn');

        if (profileForm.style.display === 'none') {
            profileForm.style.display = 'block';
            profileDisplay.style.display = 'none';
            editButton.style.display = 'none';
        } else {
            profileForm.style.display = 'none';
            profileDisplay.style.display = 'block';
            editButton.style.display = 'inline-block';
        }
    }

</script>

